---
phase: 06-frontend-product-reordering
plan: 04
type: execute
wave: 4
depends_on: ["06-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Admin can drag product rows to new positions within category"
    - "Visual feedback shows drag state (ghost preview, drop zones)"
    - "Admin can save reordered list and changes persist"
    - "Admin can cancel to revert changes"
    - "Admin can undo/redo order changes before saving"
    - "Failed saves show user-friendly error messages"
    - "Customer-facing product displays reflect admin-defined order"
  artifacts: []
  key_links: []
---

<objective>
Human verification of complete drag-and-drop product reordering feature.

Purpose: Validates that all ORDER requirements are satisfied through hands-on testing of the full reorder workflow across browsers and use cases.

Output: User approval or issue list for gap closure.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md (lines 22-34 for ORDER requirements)
@.planning/phases/06-frontend-product-reordering/06-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete drag-and-drop product reordering system:
- Reorder mode with floating action bar (Save/Cancel/Undo/Redo)
- Drag handles on product rows
- SortableJS-powered drag-and-drop with visual feedback
- Command pattern undo/redo with keyboard shortcuts (Ctrl+Z/Y)
- API integration with POST /api/admin/products/reorder
- Loading states, toast notifications, 409 conflict handling
- beforeunload warning for unsaved changes
  </what-built>
  <how-to-verify>
**Setup:**
1. Ensure backend is running (`cd backend && npm run devStart`)
2. Ensure admin has products in at least one category with 3+ items

**Test 1: Enter Reorder Mode (ORDER-05)**
1. Open admin dashboard: http://localhost:4000/admin/ (or your admin URL)
2. Click "Products List" in sidebar
3. Select a specific category from dropdown (not "All")
4. Click "Reorder Products" button
5. VERIFY: Floating action bar appears at bottom with Undo/Redo/Cancel/Save
6. VERIFY: Drag handles (grip icons) appear on left of each product row
7. VERIFY: Category dropdown is disabled
8. VERIFY: Info toast appears "Reorder mode active"

**Test 2: Drag and Drop (ORDER-01, ORDER-02, ORDER-03, ORDER-04)**
1. Grab a product by its drag handle (grip icon)
2. Drag it to a new position
3. VERIFY: Ghost preview shows semi-transparent version during drag
4. VERIFY: Product moves with smooth animation
5. VERIFY: Undo button becomes enabled after drag
6. VERIFY: Save button becomes enabled after drag

**Test 3: Undo/Redo (ORDER-10, ORDER-11)**
1. Drag multiple products to different positions (3+ moves)
2. Click Undo button
3. VERIFY: Last move is reversed
4. Click Undo again
5. VERIFY: Previous move is reversed
6. Click Redo button
7. VERIFY: Move is re-applied
8. Press Ctrl+Z (or Cmd+Z on Mac)
9. VERIFY: Undo works via keyboard
10. Press Ctrl+Y (or Cmd+Shift+Z)
11. VERIFY: Redo works via keyboard

**Test 4: Cancel (ORDER-07)**
1. Make some changes (drag products around)
2. Click Cancel button
3. VERIFY: Confirm dialog appears "Discard changes?"
4. Click Cancel in dialog - should stay in reorder mode
5. Click Cancel button again, confirm "OK"
6. VERIFY: Products return to original order
7. VERIFY: Exits reorder mode (action bar hidden)

**Test 5: Save (ORDER-06, ORDER-08)**
1. Enter reorder mode again
2. Drag products to a new order
3. Click "Save Order"
4. VERIFY: Loading overlay appears with spinner
5. VERIFY: All buttons disabled during save
6. VERIFY: Success toast "Order saved successfully!"
7. VERIFY: Exits reorder mode
8. Refresh the page
9. VERIFY: Products are still in the new saved order

**Test 6: Error Handling (ORDER-09)**
1. (Simulate by temporarily modifying network) - OPTIONAL
2. OR check that error toast appears if API fails
3. VERIFY: Error messages are user-friendly (not raw JSON)

**Test 7: Customer-Facing Order**
1. Note the current order in admin
2. Open customer-facing category page (e.g., /categories/bracelets.html)
3. VERIFY: Products appear in the order you set in admin

**Test 8: Edge Cases**
1. Try to enter reorder mode with "All" categories selected
   VERIFY: Error toast "Please select a specific category"
2. Try to enter reorder mode with search filter active
   VERIFY: Error toast "Clear search filter before reordering"
3. Try to close browser tab with unsaved changes
   VERIFY: Browser shows "Leave site?" warning
4. In reorder mode with changes, click sidebar navigation
   VERIFY: Confirm dialog appears before leaving

**OPTIONAL: Touch Device Test**
If iPad/Android tablet available:
1. Open admin on touch device
2. Enter reorder mode
3. Long-press drag handle, then drag
4. VERIFY: Drag works without triggering scroll
  </how-to-verify>
  <resume-signal>
Type one of:
- "approved" - All tests pass, feature complete
- "issues: [list of issues]" - Describe what failed for gap closure
  </resume-signal>
</task>

</tasks>

<verification>
Human tester has verified all ORDER requirements (ORDER-01 through ORDER-11):
- ORDER-01: Drag handle visible and functional
- ORDER-02: Visual feedback during drag
- ORDER-03: Drop zone feedback
- ORDER-04: Ghost preview during drag
- ORDER-05: Per-category ordering
- ORDER-06: Save button commits changes
- ORDER-07: Cancel reverts changes
- ORDER-08: Loading state during save
- ORDER-09: Error handling with user-friendly messages
- ORDER-10: Undo functionality
- ORDER-11: Redo functionality
</verification>

<success_criteria>
- User types "approved" indicating all tests pass
- OR user provides issue list for gap closure planning
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-product-reordering/06-04-SUMMARY.md`

If issues found, create `.planning/phases/06-frontend-product-reordering/06-UAT.md` with issue details for gap closure.
</output>
