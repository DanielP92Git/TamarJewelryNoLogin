---
phase: 06-frontend-product-reordering
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - admin/BisliView.js
  - admin/bambaYafa-desktop.css
autonomous: true

must_haves:
  truths:
    - "Admin can click 'Reorder' button to enter reorder mode"
    - "Admin sees floating action bar with Save/Cancel/Undo/Redo buttons"
    - "Admin can select category from dropdown before reordering"
    - "Toast notifications appear for success/error feedback"
  artifacts:
    - path: "admin/BisliView.js"
      provides: "Reorder mode UI shell and toast integration"
      contains: "enterReorderMode"
    - path: "admin/bambaYafa-desktop.css"
      provides: "Action bar and toast styles"
      contains: "reorder-action-bar"
  key_links:
    - from: "admin/BisliView.js"
      to: "Toastify"
      via: "CDN script include"
      pattern: "Toastify"
---

<objective>
Create reorder mode UI infrastructure with floating action bar, category selector, and toast notification system.

Purpose: Establishes the interactive shell for product reordering - the mode toggle, action buttons, and feedback system that users interact with. This is the foundation for drag-and-drop in Plan 02.

Output: Admin can enter/exit reorder mode, see action bar with disabled buttons, and receive toast notifications. No drag-and-drop yet.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-frontend-product-reordering/06-CONTEXT.md
@.planning/phases/06-frontend-product-reordering/06-RESEARCH.md

@admin/BisliView.js
@admin/bambaYafa-desktop.css
@admin/index.html
@frontend/css/variables.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Toastify.js and toast utility functions</name>
  <files>admin/index.html, admin/BisliView.js</files>
  <action>
1. Add Toastify.js CDN to admin/index.html (before BisliView.js script):
   ```html
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
   <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
   ```

2. Add toast utility functions to top of BisliView.js (after state object):
   ```javascript
   function showSuccessToast(message) {
     Toastify({
       text: message,
       duration: 3000,
       close: true,
       gravity: 'top',
       position: 'right',
       stopOnFocus: true,
       style: {
         background: 'linear-gradient(to right, #00b09b, #96c93d)',
         zIndex: '2000'
       }
     }).showToast();
   }

   function showErrorToast(message) {
     Toastify({
       text: message,
       duration: 5000,
       close: true,
       gravity: 'top',
       position: 'right',
       stopOnFocus: true,
       style: {
         background: 'linear-gradient(to right, #ff5f6d, #ffc371)',
         zIndex: '2000'
       }
     }).showToast();
   }

   function showInfoToast(message) {
     Toastify({
       text: message,
       duration: 3000,
       close: true,
       gravity: 'top',
       position: 'right',
       stopOnFocus: true,
       style: {
         background: 'linear-gradient(to right, #667eea, #764ba2)',
         zIndex: '2000'
       }
     }).showToast();
   }
   ```

3. Test by temporarily calling showSuccessToast('Test') in browser console after page load.
  </action>
  <verify>
Open admin in browser, open DevTools console, type `showSuccessToast('Hello')` - green toast appears top-right, auto-dismisses in 3 seconds.
  </verify>
  <done>Toastify.js loaded via CDN, three toast functions (success/error/info) available globally, z-index 2000 ensures toasts appear above all other UI.</done>
</task>

<task type="auto">
  <name>Task 2: Create reorder mode UI shell and action bar</name>
  <files>admin/BisliView.js, admin/bambaYafa-desktop.css</files>
  <action>
1. Add reorder state variables to state object in BisliView.js:
   ```javascript
   isReorderMode: false,
   originalProductOrder: [],
   undoStack: [],
   redoStack: [],
   sortableInstance: null
   ```

2. Add 'Reorder Products' button to product list header in loadProductsPage() function.
   Find the page__header section and add button after the existing content:
   ```html
   <button type="button" class="btn btn--primary reorder-toggle-btn" id="reorderToggleBtn">
     <span class="btn-icon">↕</span> Reorder Products
   </button>
   ```

3. Add floating action bar HTML at end of page content (inside .page div):
   ```html
   <div class="reorder-action-bar" id="reorderActionBar" style="display: none;">
     <button type="button" class="btn btn--secondary btn-undo" id="undoBtn" disabled>
       ↶ Undo
     </button>
     <button type="button" class="btn btn--secondary btn-redo" id="redoBtn" disabled>
       ↷ Redo
     </button>
     <div class="action-bar-spacer"></div>
     <button type="button" class="btn btn--secondary btn-cancel" id="cancelReorderBtn">
       Cancel
     </button>
     <button type="button" class="btn btn--primary btn-save" id="saveReorderBtn" disabled>
       Save Order
     </button>
   </div>
   ```

4. Add CSS styles to bambaYafa-desktop.css:
   ```css
   /* Reorder Mode - Action Bar */
   .reorder-action-bar {
     position: fixed;
     bottom: 0;
     left: 0;
     right: 0;
     background: white;
     border-top: 1px solid #e5e5e5;
     padding: 12px 24px;
     display: flex;
     gap: 12px;
     align-items: center;
     box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
     z-index: 300;
   }

   .action-bar-spacer {
     flex: 1;
   }

   .reorder-action-bar .btn {
     min-width: 100px;
   }

   .reorder-action-bar .btn:disabled {
     opacity: 0.5;
     cursor: not-allowed;
   }

   /* Reorder toggle button */
   .reorder-toggle-btn {
     margin-left: auto;
   }

   .reorder-toggle-btn .btn-icon {
     margin-right: 6px;
   }

   /* Page header flex adjustment for reorder button */
   .page__header {
     display: flex;
     align-items: center;
     flex-wrap: wrap;
     gap: 12px;
   }

   /* Ensure body has padding when action bar is visible */
   body.reorder-mode-active {
     padding-bottom: 80px;
   }
   ```

5. Add enterReorderMode() and exitReorderMode() functions:
   ```javascript
   function enterReorderMode() {
     if (state.selectedCategory === 'all') {
       showErrorToast('Please select a specific category to reorder');
       return;
     }

     const products = getFilteredProducts();
     if (products.length === 0) {
       showErrorToast('No products in this category to reorder');
       return;
     }

     state.isReorderMode = true;
     state.originalProductOrder = products.map(p => p.id);
     state.undoStack = [];
     state.redoStack = [];

     document.body.classList.add('reorder-mode-active');
     document.getElementById('reorderActionBar').style.display = 'flex';
     document.getElementById('reorderToggleBtn').style.display = 'none';

     // Disable category filter during reorder
     const categoryFilter = document.getElementById('categoryFilter');
     if (categoryFilter) categoryFilter.disabled = true;

     updateReorderButtonStates();
     showInfoToast('Reorder mode active. Drag products to reorder.');
   }

   function exitReorderMode() {
     state.isReorderMode = false;

     document.body.classList.remove('reorder-mode-active');
     document.getElementById('reorderActionBar').style.display = 'none';
     document.getElementById('reorderToggleBtn').style.display = 'inline-flex';

     // Re-enable category filter
     const categoryFilter = document.getElementById('categoryFilter');
     if (categoryFilter) categoryFilter.disabled = false;

     // Destroy sortable if exists (will be implemented in Plan 02)
     if (state.sortableInstance) {
       state.sortableInstance.destroy();
       state.sortableInstance = null;
     }
   }

   function updateReorderButtonStates(disabled = false) {
     const undoBtn = document.getElementById('undoBtn');
     const redoBtn = document.getElementById('redoBtn');
     const saveBtn = document.getElementById('saveReorderBtn');
     const cancelBtn = document.getElementById('cancelReorderBtn');

     if (disabled) {
       [undoBtn, redoBtn, saveBtn, cancelBtn].forEach(btn => btn.disabled = true);
       return;
     }

     undoBtn.disabled = state.undoStack.length === 0;
     redoBtn.disabled = state.redoStack.length === 0;
     saveBtn.disabled = state.undoStack.length === 0;
     cancelBtn.disabled = false;
   }

   function getFilteredProducts() {
     // Return products currently visible in the list
     const category = state.selectedCategory;
     if (!state.products || category === 'all') return [];
     return state.products.filter(p => p.category === category);
   }
   ```

6. Add event listeners in loadProductsPage() after the markup is inserted:
   ```javascript
   // Reorder mode button handlers
   const reorderToggleBtn = document.getElementById('reorderToggleBtn');
   if (reorderToggleBtn) {
     reorderToggleBtn.addEventListener('click', enterReorderMode);
   }

   const cancelReorderBtn = document.getElementById('cancelReorderBtn');
   if (cancelReorderBtn) {
     cancelReorderBtn.addEventListener('click', () => {
       if (state.undoStack.length > 0) {
         if (!confirm('Discard changes and exit reorder mode?')) return;
       }
       exitReorderMode();
       loadProducts(state.products); // Restore original order
     });
   }

   // Save and undo/redo handlers will be added in Plan 03
   ```
  </action>
  <verify>
1. Open admin/index.html in browser
2. Navigate to Products List
3. Select a specific category (not 'All')
4. Click 'Reorder Products' button
5. Verify: Floating action bar appears at bottom with Undo/Redo/Cancel/Save buttons
6. Verify: Category dropdown is disabled
7. Verify: Info toast shows 'Reorder mode active'
8. Click Cancel - action bar disappears, category dropdown re-enabled
  </verify>
  <done>Reorder mode toggle works, action bar displays with all buttons, category must be selected before reordering, toast feedback on mode entry.</done>
</task>

<task type="auto">
  <name>Task 3: Add drag handles to product rows</name>
  <files>admin/BisliView.js, admin/bambaYafa-desktop.css</files>
  <action>
1. Modify loadProducts() function to add drag handle to each product row.
   Find the productElement.innerHTML template and add drag handle as first element:
   ```html
   <div class="drag-handle" style="display: none;" title="Drag to reorder">
     <span class="drag-icon">⋮⋮</span>
   </div>
   ```

2. Update enterReorderMode() to show drag handles:
   ```javascript
   // Show drag handles
   document.querySelectorAll('.drag-handle').forEach(el => {
     el.style.display = 'flex';
   });
   ```

3. Update exitReorderMode() to hide drag handles:
   ```javascript
   // Hide drag handles
   document.querySelectorAll('.drag-handle').forEach(el => {
     el.style.display = 'none';
   });
   ```

4. Add CSS for drag handle:
   ```css
   /* Drag Handle */
   .drag-handle {
     display: none;
     align-items: center;
     justify-content: center;
     width: 24px;
     height: 100%;
     cursor: grab;
     color: #9ca3af;
     font-size: 14px;
     user-select: none;
     transition: color 0.15s;
   }

   .drag-handle:hover {
     color: #4b5563;
   }

   .drag-handle:active {
     cursor: grabbing;
   }

   .drag-icon {
     letter-spacing: 2px;
   }

   /* RTL support for drag handle */
   [dir="rtl"] .drag-handle {
     order: -1;
   }

   /* Product row adjustments for drag handle */
   .listproduct-format {
     transition: background-color 0.15s, box-shadow 0.15s;
   }

   .reorder-mode-active .listproduct-format {
     cursor: default;
   }

   /* SortableJS classes (from variables.css) - ensure proper layering */
   .sortable-ghost {
     opacity: 0.4;
     background-color: #f0f0f0;
   }

   .sortable-chosen {
     box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
     background-color: white;
   }

   .sortable-drag {
     opacity: 1;
   }
   ```

5. Adjust the grid template in .listproduct-format to accommodate drag handle column.
   Find existing grid-template-columns and prepend 24px for handle:
   ```css
   /* Adjust grid when in reorder mode */
   .reorder-mode-active .listproduct-format {
     grid-template-columns: 24px 40px 2fr 80px 80px 60px 80px 100px 120px;
   }
   ```
   (Keep original grid for non-reorder mode)
  </action>
  <verify>
1. Open admin, go to Products List
2. Select specific category, click 'Reorder Products'
3. Verify: Each product row now has grip icon (⋮⋮) on the left
4. Verify: Grip icon has grab cursor on hover
5. Click Cancel - grip icons disappear
  </verify>
  <done>Drag handles (⋮⋮) appear on each product row in reorder mode, hidden in normal mode, proper cursor states and styling applied.</done>
</task>

</tasks>

<verification>
1. Toastify.js loaded and toast functions work (showSuccessToast, showErrorToast, showInfoToast)
2. 'Reorder Products' button visible in product list header
3. Clicking button with 'All' category shows error toast
4. Clicking button with specific category enters reorder mode:
   - Floating action bar appears with Undo/Redo/Cancel/Save
   - Category dropdown disabled
   - Info toast displayed
   - Drag handles visible on rows
5. Cancel button exits reorder mode, restores normal UI
6. No JavaScript errors in console
</verification>

<success_criteria>
- Toast notification system functional (CDN-based Toastify.js)
- Reorder mode can be entered/exited cleanly
- Action bar displays with all buttons (disabled appropriately)
- Drag handles visible only in reorder mode
- Category selection required before reordering
- No drag functionality yet (that's Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-product-reordering/06-01-SUMMARY.md`
</output>
