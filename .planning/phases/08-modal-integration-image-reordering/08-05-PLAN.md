---
phase: 08-modal-integration-image-reordering
plan: 05
type: execute
wave: 3
depends_on: ["08-02", "08-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All modal requirements (MODAL-01 through MODAL-09) verified working"
    - "All image reordering requirements (IMAGE-03 through IMAGE-08) verified working"
    - "No regressions in existing product list or edit functionality"
    - "RTL (Hebrew) mode works correctly for modal and gallery"
---

<objective>
Human verification of complete modal and image reordering features.

Purpose: Validate that all 15 requirements for Phase 8 work correctly through manual testing. Catch any visual, functional, or accessibility issues before marking phase complete.

Output: All test scenarios pass, phase can be marked complete.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/08-modal-integration-image-reordering/08-01-SUMMARY.md
@.planning/phases/08-modal-integration-image-reordering/08-02-SUMMARY.md
@.planning/phases/08-modal-integration-image-reordering/08-03-SUMMARY.md
@.planning/phases/08-modal-integration-image-reordering/08-04-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Product Preview Modal</name>
  <what-built>
Product preview modal using native HTML dialog element with:
- Click product row to open modal
- Customer-facing product view (images, title, description, SKU, price)
- Close via X button, ESC key, and backdrop click
- Focus trap (Tab cycles within modal)
- ARIA labels for accessibility
- Action buttons: Edit, Delete, Duplicate
  </what-built>
  <how-to-verify>
**Prerequisites:** Start backend server and access admin at http://localhost:5500/admin or production URL.

**Test 1: Modal Opens (MODAL-01)**
1. Go to Products List in admin
2. Click on any product row (not on Edit/Delete/Duplicate buttons)
3. Expected: Modal opens showing product preview

**Test 2: Customer View Display (MODAL-02)**
1. With modal open, verify it shows:
   - Product main image (large)
   - Image thumbnails (if multiple images)
   - Product title
   - Product description
   - SKU (if product has one)
   - Price in ILS
2. Click different thumbnails - main image should update
3. Compare with customer-facing view on frontend - should match

**Test 3: Close Methods (MODAL-04, MODAL-05, MODAL-06)**
1. Open modal, click X button -> modal closes
2. Open modal, press ESC key -> modal closes
3. Open modal, click outside modal (on dark backdrop) -> modal closes

**Test 4: Focus Trap (MODAL-07)**
1. Open modal
2. Press Tab repeatedly
3. Expected: Focus cycles through modal elements only (close button, thumbnails, action buttons)
4. Focus should NOT go to elements behind modal

**Test 5: Accessibility (MODAL-08)**
1. Open browser DevTools, inspect the dialog element
2. Verify: role="dialog", aria-modal="true", aria-labelledby points to title
3. Verify close button has aria-label

**Test 6: Edit Action (MODAL-03)**
1. Open modal for a product
2. Click Edit button
3. Expected: Modal closes, edit form opens for that product

**Test 7: Delete Action (MODAL-09)**
1. Open modal for a TEST product (one you can delete)
2. Click Delete button
3. Expected: Confirmation dialog appears
4. Click Cancel -> nothing happens, modal stays
5. Click OK/Confirm -> product deleted, toast shows, list refreshes

**Test 8: Duplicate Action (MODAL-09)**
1. Open modal for a product
2. Click Duplicate button
3. Expected: Modal closes, add product form opens with data pre-filled
4. Verify name, description, price, category are populated
  </how-to-verify>
  <resume-signal>
Type "modal-approved" if all 8 modal tests pass.
If any test fails, describe the issue (e.g., "Test 3 failed: backdrop click doesn't close modal").
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Image Gallery Reordering</name>
  <what-built>
Drag-and-drop image gallery reordering in product edit form with:
- Gallery thumbnails with drag handles
- SortableJS drag-and-drop
- Visual feedback (ghost, chosen states)
- Main image badge on first position
- Delete button on each thumbnail
- Order persistence on form save
  </what-built>
  <how-to-verify>
**Prerequisites:** Have a product with at least 3 images for testing.

**Test 1: Gallery Display (IMAGE-03 setup)**
1. Click Edit on a product with multiple images
2. Find the "Product Gallery" section
3. Expected: Thumbnails display in a row with drag handles visible on hover

**Test 2: Main Image Indicator (IMAGE-07)**
1. First thumbnail should have:
   - Green border
   - "Main" badge in bottom-left corner
2. Other thumbnails should NOT have the badge

**Test 3: Drag Feedback (IMAGE-04, IMAGE-05)**
1. Hover over a thumbnail - drag handle (6 dots) appears
2. Grab the drag handle and start dragging
3. Expected:
   - Dragged item shows ghost/opacity state
   - Other items shift to show drop position
   - Smooth animation during drag

**Test 4: Reorder and Badge Update**
1. Drag the second image to first position
2. Expected: "Main" badge moves to the new first image
3. Drag it back - badge should update again

**Test 5: Order Persistence (IMAGE-06)**
1. Reorder images (make a notable change, e.g., move last to first)
2. Click Save button on the form
3. Wait for save confirmation
4. Navigate away, then Edit the same product again
5. Expected: Images are in the new order you set

**Test 6: Delete Image (IMAGE-08)**
1. Hover over a non-main image thumbnail
2. Click the X (delete) button in top-right
3. Expected: Confirmation dialog appears
4. Confirm deletion
5. Expected: Image disappears from gallery, toast shows
6. If you deleted the first image, next image should become main
7. Save the product
8. Re-edit to verify deletion persisted

**Test 7: Empty Gallery Edge Case**
1. If you have a product with only 1 image, delete it
2. Expected: Gallery shows "No images remaining" message
3. Form should still be saveable
  </how-to-verify>
  <resume-signal>
Type "gallery-approved" if all 7 gallery tests pass.
If any test fails, describe the issue (e.g., "Test 5 failed: order didn't persist after save").
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify RTL and Regression Testing</name>
  <what-built>
RTL (Hebrew) support for modal and gallery, no regressions in existing functionality.
  </what-built>
  <how-to-verify>
**RTL Testing:**
1. If you can switch admin to Hebrew mode (or have Hebrew test data):
   - Open a product modal
   - Verify: Close button is on correct side, text aligns correctly
   - Edit a product with images
   - Verify: Gallery layout works correctly in RTL

**Regression Testing:**
1. Product List operations still work:
   - Category filter
   - Search filter
   - Reorder mode (drag products)
   - Inline SKU editing

2. Edit form operations still work:
   - All fields save correctly
   - Image upload still works (if you want to test)
   - Form validation

3. Modal doesn't interfere:
   - Click Edit button on product row (not row itself) - goes to edit form directly
   - Click Delete button on product row - deletes without opening modal
   - Click Duplicate button on product row - duplicates without opening modal
  </how-to-verify>
  <resume-signal>
Type "verified" if RTL and regression tests pass.
If any issue found, describe it.
  </resume-signal>
</task>

</tasks>

<verification>
Phase 8 is complete when:
- [ ] All modal tests pass (MODAL-01 through MODAL-09)
- [ ] All gallery tests pass (IMAGE-03 through IMAGE-08)
- [ ] RTL support verified
- [ ] No regressions in existing functionality
</verification>

<success_criteria>
All requirements verified:

**Modal Requirements:**
- [ ] MODAL-01: Click product row opens preview modal
- [ ] MODAL-02: Modal displays customer-facing view
- [ ] MODAL-03: Edit button navigates to edit page
- [ ] MODAL-04: X button closes modal
- [ ] MODAL-05: ESC key closes modal
- [ ] MODAL-06: Backdrop click closes modal
- [ ] MODAL-07: Focus trap works
- [ ] MODAL-08: ARIA labels present
- [ ] MODAL-09: Quick action buttons (Edit, Delete, Duplicate)

**Image Gallery Requirements:**
- [ ] IMAGE-03: Drag thumbnails to reorder
- [ ] IMAGE-04: Visual feedback during drag
- [ ] IMAGE-05: Drop indicator position
- [ ] IMAGE-06: Order saves on form submit
- [ ] IMAGE-07: Main image indicator
- [ ] IMAGE-08: Delete image with confirmation
</success_criteria>

<output>
After completion, create `.planning/phases/08-modal-integration-image-reordering/08-05-SUMMARY.md` documenting:
- All tests that passed
- Any bugs found and fixed during verification
- Final phase status
</output>
