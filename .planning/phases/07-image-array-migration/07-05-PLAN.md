---
phase: 07-image-array-migration
plan: 05
type: execute
wave: 4
depends_on: ["07-03", "07-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All products display correctly on customer-facing pages"
    - "Product modals show main image and gallery thumbnails"
    - "Admin can create new products with images"
    - "Admin can edit existing products and images persist"
    - "Migration can be rolled back if critical issues found"
  artifacts: []
  key_links: []
---

<objective>
Human verification of complete image array migration across all surfaces.

Purpose: Confirm migration success through manual testing of customer-facing display, admin workflows, and data integrity. This is the final quality gate before considering the migration complete.

Output: Verification approval or list of issues requiring gap closure plans.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-image-array-migration/07-03-SUMMARY.md
@.planning/phases/07-image-array-migration/07-04-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete image array migration:
- Database migration: mainImage + smallImages unified into images array
- Backend API: Returns both images array and derived mainImage/smallImages
- Frontend: Displays images from unified array with fallback to old fields
- Admin endpoints: Create/edit products using images array
  </what-built>
  <how-to-verify>
**Customer-Facing Display (5 tests):**

1. Browse category page (e.g., /bracelets.html)
   - [ ] Products display with correct main images
   - [ ] No broken image icons
   - [ ] Images load without significant delay

2. Click a product with multiple images
   - [ ] Modal opens with main image displayed
   - [ ] Gallery thumbnails appear on left sidebar
   - [ ] Clicking thumbnail changes main image
   - [ ] Fullscreen gallery works (click main image)

3. Click a product with single image
   - [ ] Modal opens with image displayed
   - [ ] No gallery sidebar (or single thumbnail)
   - [ ] No JavaScript errors in console

4. Test responsive display
   - [ ] Resize browser to mobile width (<800px)
   - [ ] Mobile-optimized images load (if available)
   - [ ] Product modal works on narrow viewport

5. Add product to cart from modal
   - [ ] Cart count increases
   - [ ] Product image appears correctly in cart

**Admin Workflows (3 tests):**

6. View product list in admin
   - [ ] Product thumbnails display correctly
   - [ ] All products visible (no missing images)

7. Edit existing product (DO NOT save unless testing image upload)
   - [ ] Product images load in edit form
   - [ ] No errors when viewing edit page
   - Optional: Upload new image and verify it persists

8. API verification (browser dev tools)
   - [ ] Open Network tab
   - [ ] Reload category page
   - [ ] Find /productsByCategory request
   - [ ] Inspect response - products should have `images` array

**Data Integrity (via terminal - optional):**

9. Run verification command:
```bash
cd backend
node -e "require('dotenv').config(); const mongoose = require('mongoose'); mongoose.connect(process.env.DB_CONNECTION_STRING).then(async () => { const total = await mongoose.connection.db.collection('products').countDocuments({}); const withImages = await mongoose.connection.db.collection('products').countDocuments({images: {\$exists: true, \$ne: []}}); console.log('Total:', total, '| With images:', withImages, '| Coverage:', (withImages/total*100).toFixed(1)+'%'); mongoose.disconnect(); })"
```
Expected: 100% coverage (or close, depending on products with no images)
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass.

If issues found, describe them in format:
"Issue: [test number] - [description of problem]"

Example:
"Issue: 2 - Gallery thumbnails not appearing on product modal"
  </resume-signal>
</task>

</tasks>

<verification>
Phase 7 Plan 05 complete when:
- [ ] Human verification completed
- [ ] All 8 test scenarios pass (or issues documented)
- [ ] "approved" signal received OR gap closure needed
</verification>

<success_criteria>
All requirements verified:
- FOUND-05: Migration script converts mainImage + smallImages to images array (verified by data presence)
- FOUND-06: Backwards compatibility maintained (old fields still in responses)
- IMAGE-01: Product schema merges mainImage + galleryImages into single images array (verified by schema)
- IMAGE-02: First image in array becomes main/featured (verified by display)
</success_criteria>

<output>
After completion, create `.planning/phases/07-image-array-migration/07-05-SUMMARY.md`
</output>
