---
phase: 24-static-page-ssr-meta-tags-deployment-merge
plan: 04
type: execute
wave: 3
depends_on: ["24-02", "24-03"]
files_modified:
  - .do/app.yaml
  - backend/index.js
autonomous: false

must_haves:
  truths:
    - "A single .do/app.yaml defines one Express service that builds frontend, installs backend deps, and runs the Express server"
    - "Express serves both frontend static assets (CSS, JS, images) and SSR pages from one process"
    - "All SSR pages verified: /en, /he, /en/about, /he/about, /en/contact, /he/contact, /en/workshop, /he/workshop, /en/policies, /he/policies all return 200 with correct content"
  artifacts:
    - path: ".do/app.yaml"
      provides: "DigitalOcean App Platform deployment config"
      contains: "services"
  key_links:
    - from: ".do/app.yaml"
      to: "backend/index.js"
      via: "run_command starts Express server"
      pattern: "run_command"
---

<objective>
Create the DigitalOcean App Platform deployment configuration for a single unified Express service and verify all SSR pages work end-to-end.

Purpose: Merging from 2 components (static site + API) to 1 unified Express service simplifies deployment, reduces cost, and ensures SSR pages are served correctly. This plan also serves as the final verification checkpoint for the entire phase.
Output: .do/app.yaml, verified SSR rendering across all pages
</objective>

<execution_context>
@C:/Users/pagis/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/pagis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-RESEARCH.md
@.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-02-SUMMARY.md
@.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-03-SUMMARY.md
@DIGITALOCEAN_SETUP.md
@backend/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DigitalOcean App Platform deployment configuration</name>
  <files>.do/app.yaml</files>
  <action>
Create `.do/app.yaml` at the project root (create the .do/ directory if it doesn't exist).

The configuration defines a SINGLE service that:
1. Builds the frontend: `cd frontend && npm ci && npm run build`
2. Installs backend dependencies: `cd ../backend && npm ci`
3. Runs the Express server: `cd backend && npm start`
4. Serves on port 3000 (or whatever PORT the backend listens on - check backend/index.js for the port)
5. Routes all traffic (/) to this single service

```yaml
name: tamar-kfir-jewelry
region: nyc

services:
  - name: web
    github:
      repo: <user>/tamar-kfir-jewelry
      branch: master
      deploy_on_push: true

    build_command: cd frontend && npm ci && npm run build && cd ../backend && npm ci
    run_command: cd backend && npm start

    environment_slug: node-js
    instance_count: 1
    instance_size_slug: basic-xxs
    http_port: 3000

    routes:
      - path: /

    envs:
      - key: NODE_ENV
        value: "production"
      - key: BASE_URL
        value: "${APP_URL}"
```

NOTE: Do NOT include secrets (MONGODB_URI, JWT_SECRET, payment keys, Spaces credentials) in the yaml file. Those are configured via the DigitalOcean dashboard. Only include NODE_ENV and BASE_URL which are non-sensitive.

Check backend/index.js for the actual port number (likely process.env.PORT || 3000 or 4000) and set http_port accordingly.

Use placeholder for the github repo path since the actual repo name should be configured by the user. Add a comment in the yaml noting this.
  </action>
  <verify>Validate YAML syntax: the file should be parseable. Check that build_command builds frontend first, then installs backend. Check run_command starts the backend server. Verify only one service is defined (no separate static site component).</verify>
  <done>.do/app.yaml exists with single-service deployment config that builds frontend and runs Express</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify all SSR pages render correctly with meta tags</name>
  <files></files>
  <action>
Present the user with verification steps for all SSR pages created in Plans 01-04.

What was built:
- /en and /he (home page with products and Organization JSON-LD)
- /en/about and /he/about
- /en/contact and /he/contact
- /en/workshop and /he/workshop
- /en/policies and /he/policies
- .do/app.yaml for unified deployment

Each page has: unique title, meta description, canonical URL, Open Graph tags, Twitter Card tags, hreflang alternates (en, he, x-default).
  </action>
  <verify>
1. Start the backend dev server: `cd backend && npm run devStart`
2. Visit http://localhost:4000/en — verify home page renders with products, check View Source for Organization JSON-LD
3. Visit http://localhost:4000/he — verify Hebrew version with RTL layout
4. Visit http://localhost:4000/en/about — verify about page content is visible (not empty containers)
5. Visit http://localhost:4000/he/about — verify Hebrew about text renders
6. Visit http://localhost:4000/en/contact — verify contact page
7. Visit http://localhost:4000/en/workshop — verify workshop page
8. Visit http://localhost:4000/en/policies — verify policies page
9. On any page, View Source and confirm:
   - title tag is unique and descriptive
   - meta name="description" is present and unique
   - link rel="canonical" points to self
   - og:title, og:description, og:image, og:url are present
   - twitter:card, twitter:title are present
   - Three hreflang links: en, he, x-default
10. On the home page source, confirm script type="application/ld+json" contains Organization schema
  </verify>
  <done>User has verified all SSR pages render correctly with full content, meta tags, and structured data</done>
</task>

</tasks>

<verification>
- .do/app.yaml defines exactly 1 service (no static site component)
- All 10 URL paths (/en, /he, /en/about, /he/about, /en/contact, /he/contact, /en/workshop, /he/workshop, /en/policies, /he/policies) return 200
- Every page has unique title and description
- Every page has canonical, OG, Twitter Card, and hreflang tags
- Home page has Organization JSON-LD
- All pages render content server-side (visible in View Source)
- Hebrew pages have dir="rtl" and Hebrew content
- All existing tests pass
</verification>

<success_criteria>
Phase 24 complete: all static pages and home page SSR-rendered with full SEO metadata, Organization structured data on home page, and unified deployment configuration ready.
</success_criteria>

<output>
After completion, create `.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-04-SUMMARY.md`
</output>
