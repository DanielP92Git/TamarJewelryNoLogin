---
phase: 24-static-page-ssr-meta-tags-deployment-merge
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/routes/ssr.js
  - .planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-VERIFICATION.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Home page SSR renders category grid matching the existing frontend homePageView.js output"
    - "renderHomePage does not perform unnecessary database queries for unused data"
    - "VERIFICATION.md updated to reflect gap resolution with false-positive determination"
  artifacts:
    - path: "backend/routes/ssr.js"
      provides: "Home page route handler without unnecessary product query"
    - path: ".planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-VERIFICATION.md"
      provides: "Updated verification with gap resolved"
  key_links: []
---

<objective>
Resolve the verification gap regarding missing product grid on the home page SSR template.

Purpose: The verification flagged "Product names and prices are visible in the HTML source" as FAILED. Investigation confirms this is a FALSE POSITIVE: the frontend homePageView.js renders ONLY a category grid (no product grid). SSR-05 requires templates to match client-side output. The template correctly matches. Clean up the unused product DB query in the route handler and update VERIFICATION.md.

Output: Cleaned route handler (no wasted DB query), updated VERIFICATION.md documenting the resolution.
</objective>

<execution_context>
@C:/Users/pagis/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/pagis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-03-SUMMARY.md
@backend/routes/ssr.js
@frontend/js/Views/homePageView.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused product query from renderHomePage and update VERIFICATION.md</name>
  <files>backend/routes/ssr.js, .planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-VERIFICATION.md</files>
  <action>
    **Evidence of false positive:** The frontend `homePageView.js` contains ONLY:
    - Category name rendering (`setCategoriesLng` method)
    - Language switching
    - Cart icon visibility
    - NO product grid rendering whatsoever

    The home page has NEVER shown products -- only categories. SSR-05 says templates must match client-side output. The template correctly matches.

    **In `backend/routes/ssr.js` `renderHomePage` function:**
    1. Remove the `Product` model import at the top (line 3: `const Product = require('../models/Product');`)
    2. Remove the products query block (lines 137-146: the try/catch with `Product.find`)
    3. Remove the `products` and `currency` variables from the `res.render` call (lines 170-171)
    4. Refactor `renderHomePage` to use `buildPageData` helper like the other route handlers, since it no longer needs async DB queries. Change from `async function` to regular `function`.

    The refactored `renderHomePage` should look like:
    ```javascript
    function renderHomePage(req, res) {
      const pageData = buildPageData(req, 'home', [
        { href: '/css/standard-reset.css' },
        { href: '/css/desktop-menu.css' },
        { href: '/css/home-mobile.css', media: '(max-width: 799.9px)' },
        { href: '/css/home-800plus.css', media: '(min-width: 800px)' },
        { href: '/css/footer-desktop.css', media: '(min-width: 800px)' },
        { href: '/css/footer-mobile.css', media: '(max-width: 799.9px)' },
        { href: '/css/mobile-menu.css', media: '(max-width: 799.9px)' },
      ]);

      res.render('pages/home', pageData);
    }
    ```

    **In `24-VERIFICATION.md`:**
    1. Change frontmatter `status` from `gaps_found` to `passed`
    2. Change frontmatter `score` from `17/19` to `19/19` (the original score said 17 but body said 18, either way all pass now)
    3. Remove the `gaps:` section from frontmatter
    4. Update truth #16 status from `FAILED` to `VERIFIED (false positive resolved)` with evidence: "Frontend homePageView.js does not render a product grid. Home page shows categories only. SSR template correctly matches client-side output per SSR-05. Unused product query removed from route handler."
    5. Update the Gaps Summary section to document the false positive finding and resolution
    6. Update Overall Assessment to reflect all 19/19 truths verified
  </action>
  <verify>
    1. `grep -c "Product" backend/routes/ssr.js` returns 0 (no Product model usage)
    2. `grep -c "async" backend/routes/ssr.js` returns 0 (no async functions needed)
    3. `grep "status: passed" .planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-VERIFICATION.md` succeeds
    4. Run backend tests: `cd backend && npm test` -- all pass
  </verify>
  <done>
    - renderHomePage no longer queries Product model (no wasted DB call)
    - renderHomePage uses buildPageData helper like all other handlers (consistent pattern)
    - Product model import removed from routes/ssr.js
    - VERIFICATION.md shows status: passed with 19/19 truths verified
    - Gap documented as false positive with evidence from frontend code
    - All backend tests pass
  </done>
</task>

</tasks>

<verification>
1. `backend/routes/ssr.js` has no reference to Product model
2. `renderHomePage` is a synchronous function using `buildPageData` helper
3. Home page still renders correctly at /en and /he (category grid, hero, JSON-LD all present)
4. VERIFICATION.md reflects passed status with all truths verified
5. All backend tests pass with no regressions
</verification>

<success_criteria>
- The false positive gap is documented with evidence (frontend homePageView.js has no product grid)
- Unnecessary Product DB query removed from home page route handler
- Route handler simplified to match pattern of other static page handlers
- VERIFICATION.md updated to passed status (19/19)
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-05-SUMMARY.md`
</output>
