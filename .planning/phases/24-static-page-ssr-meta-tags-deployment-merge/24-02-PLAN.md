---
phase: 24-static-page-ssr-meta-tags-deployment-merge
plan: 02
type: execute
wave: 2
depends_on: ["24-01"]
files_modified:
  - backend/views/pages/about.ejs
  - backend/views/pages/contact.ejs
  - backend/views/pages/workshop.ejs
  - backend/views/pages/policies.ejs
  - backend/routes/ssr.js
  - backend/index.js
autonomous: true

must_haves:
  truths:
    - "Visiting /en/about returns fully-rendered HTML with About page content visible in page source"
    - "Visiting /he/about returns Hebrew content with dir=rtl"
    - "Visiting /en/contact returns fully-rendered HTML with contact page content"
    - "Visiting /en/workshop returns fully-rendered HTML with workshop content"
    - "Visiting /en/policies returns fully-rendered HTML with policies content"
    - "Every static page source shows unique title, meta description, canonical, OG tags, hreflang"
    - "Page content is readable without JavaScript enabled"
  artifacts:
    - path: "backend/views/pages/about.ejs"
      provides: "SSR about page template"
      contains: "aboutme-description"
    - path: "backend/views/pages/contact.ejs"
      provides: "SSR contact page template"
      contains: "contact"
    - path: "backend/views/pages/workshop.ejs"
      provides: "SSR workshop page template"
      contains: "workshop"
    - path: "backend/views/pages/policies.ejs"
      provides: "SSR policies page template"
      contains: "policies"
    - path: "backend/routes/ssr.js"
      provides: "SSR route handlers"
      exports: ["renderAboutPage", "renderContactPage", "renderWorkshopPage", "renderPoliciesPage"]
  key_links:
    - from: "backend/routes/ssr.js"
      to: "backend/config/meta.js"
      via: "require('../config/meta')"
      pattern: "metaConfig"
    - from: "backend/routes/ssr.js"
      to: "backend/views/pages/*.ejs"
      via: "res.render('pages/about', pageData)"
      pattern: "res\\.render"
    - from: "backend/index.js"
      to: "backend/routes/ssr.js"
      via: "require and app.get route registration"
      pattern: "app\\.get.*/:lang"
---

<objective>
Create EJS templates and route handlers for all four static pages (about, contact, workshop, policies) with full bilingual content and SEO meta tags.

Purpose: These pages are the simplest SSR targets - static content with no database queries. Getting them right establishes the template pattern for the home page and future dynamic pages.
Output: 4 EJS page templates, SSR route handler module, routes wired into Express
</objective>

<execution_context>
@C:/Users/pagis/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/pagis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-RESEARCH.md
@.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-01-SUMMARY.md
@frontend/html/about.html
@frontend/html/contact-me.html
@frontend/html/jewelry-workshop.html
@frontend/html/policies.html
@frontend/js/Views/aboutView.js
@frontend/js/Views/contactMeView.js
@frontend/js/Views/workshopView.js
@frontend/js/Views/policiesView.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SSR route handler module and static page EJS templates</name>
  <files>backend/routes/ssr.js, backend/views/pages/about.ejs, backend/views/pages/contact.ejs, backend/views/pages/workshop.ejs, backend/views/pages/policies.ejs</files>
  <action>
Create `backend/routes/ssr.js` with route handler functions for each static page. Each handler:
1. Extracts `lang` from req.params (en/he) and maps to langKey (eng/heb)
2. Sets dir = langKey === 'heb' ? 'rtl' : 'ltr'
3. Loads meta from `require('../config/meta')` for the page
4. Constructs baseUrl from `process.env.BASE_URL || 'https://tamarkfir.online'`
5. Builds pageData object with: lang (langKey), urlLang (en/he), dir, title, description, canonical (absolute URL), ogImage, baseUrl, alternateUrl ({en, he}), pageStyles (CSS files for the page)
6. Calls `res.render('pages/<pageName>', pageData)`

Export: renderAboutPage, renderContactPage, renderWorkshopPage, renderPoliciesPage

Create EJS templates for each page. Each template follows the same structure:

```
<!DOCTYPE html>
<html lang="<%= urlLang %>" dir="<%= dir %>">
<head>
  <%- include('../partials/meta-tags', { title, description, canonical, ogImage, lang, urlLang, alternateUrl, baseUrl, pageStyles }) %>
  <script type="module" defer src="/js/controller.js"></script>
  <!-- Microsoft Clarity snippet -->
</head>
<body id="<pageId>">
  <%- include('../partials/header', { lang, dir, urlLang }) %>
  <main>
    <!-- Page-specific content with bilingual text -->
  </main>
  <%- include('../partials/footer', { lang, urlLang }) %>
</body>
</html>
```

**about.ejs**: Body id="about". Content structure matches frontend/html/about.html:
- `<div class="first-row-container">` with title-and-text-container and image-container
- `<h1 id="page-title">` with "ABOUT ME" (eng) or "אודותי" (heb)
- `<div class="aboutme-description">` with FULL text content from aboutView.js handleAboutMeLanguage() - both English and Hebrew versions, rendered server-side based on lang variable
- Image: `<img src="/imgs/website-images/preview-images/IMG_5418 (Medium).jpeg" class="description-img">`
- CSS: about-devices.css (max-width: 799.9px), about-800plus.css (min-width: 800px)

**contact.ejs**: Body id="contact-me". Look at frontend/html/contact-me.html and frontend/js/Views/contactMeView.js for the HTML structure and bilingual content. Include the contact form structure, EmailJS integration script. The form should be rendered with correct labels in the URL language.
- CSS: contact-me-devices.css, contact-me-800plus.css

**workshop.ejs**: Body id="workshop". Look at frontend/html/jewelry-workshop.html and frontend/js/Views/workshopView.js for the HTML structure and bilingual content. Include workshop description, images, and booking information.
- CSS: workshop-devices.css, workshop-800plus.css (check actual filenames in frontend/css/)

**policies.ejs**: Body id="policies". Look at frontend/html/policies.html and frontend/js/Views/policiesView.js for the HTML structure and bilingual content. Include shipping, returns, and care instruction content.
- CSS: policies-devices.css, policies-800plus.css (check actual filenames)

CRITICAL: Check the actual CSS filenames in frontend/css/ directory before setting pageStyles. The naming convention may vary (e.g., "about-devices.css" vs "aboutme-devices.css").

CRITICAL: Extract the FULL bilingual text content from each View JS file (the strings returned by language handler methods). This text must be rendered server-side so crawlers see it. Use `<%= lang === 'eng' ? 'English text' : 'Hebrew text' %>` pattern for short strings, and `<% if (lang === 'eng') { %>...English block...<% } else { %>...Hebrew block...<% } %>` for long content blocks.

CRITICAL: The HTML structure, CSS classes, and body IDs must match the existing frontend HTML exactly. The client-side JS will look for these elements by class/ID to add interactivity (language switching, menu toggles, etc.).
  </action>
  <verify>
Start the backend dev server. Test each route:
- `curl -s http://localhost:4000/en/about | head -30` — should show DOCTYPE, lang="en", meta tags, h1 with "ABOUT ME"
- `curl -s http://localhost:4000/he/about | head -30` — should show lang="he", dir="rtl", Hebrew title
- `curl -s http://localhost:4000/en/contact | head -20` — should show contact page meta
- `curl -s http://localhost:4000/en/workshop | head -20` — should show workshop page meta
- `curl -s http://localhost:4000/en/policies | head -20` — should show policies page meta
- Verify og:title, canonical URL, and hreflang tags appear in each response
- Run existing test suite: `cd backend && npx vitest run` — all tests pass
  </verify>
  <done>All four static pages render at /en/{page} and /he/{page} with full bilingual content, correct meta tags, matching HTML structure, and no test regressions</done>
</task>

<task type="auto">
  <name>Task 2: Wire SSR routes into Express and apply language middleware</name>
  <files>backend/index.js</files>
  <action>
In backend/index.js, in the "Bilingual SSR routes" section (after the test route around line 1172):

1. Import the SSR route handlers: `const { renderAboutPage, renderContactPage, renderWorkshopPage, renderPoliciesPage } = require('./routes/ssr');`
2. Register routes with languageMiddleware (already imported from Phase 23-03):
   ```javascript
   app.get('/:lang(en|he)/about', languageMiddleware, renderAboutPage);
   app.get('/:lang(en|he)/contact', languageMiddleware, renderContactPage);
   app.get('/:lang(en|he)/workshop', languageMiddleware, renderWorkshopPage);
   app.get('/:lang(en|he)/policies', languageMiddleware, renderPoliciesPage);
   ```
3. Place these AFTER the test route but BEFORE API routes and the invalid-language catch-all routes.

The languageMiddleware (from backend/middleware/language.js) already sets req.lang and req.dir. The route handlers should use req.params.lang for URL construction (en/he) and can use req.lang/req.dir if languageMiddleware sets those, OR derive them from req.params.lang directly. Check what languageMiddleware actually sets and use consistently.

Do NOT remove the test route — it remains for debugging.
  </action>
  <verify>
- `curl -s -o /dev/null -w "%{http_code}" http://localhost:4000/en/about` returns 200
- `curl -s -o /dev/null -w "%{http_code}" http://localhost:4000/he/about` returns 200
- `curl -s -o /dev/null -w "%{http_code}" http://localhost:4000/en/contact` returns 200
- `curl -s -o /dev/null -w "%{http_code}" http://localhost:4000/he/workshop` returns 200
- `curl -s -o /dev/null -w "%{http_code}" http://localhost:4000/en/policies` returns 200
- `curl -s -o /dev/null -w "%{http_code}" http://localhost:4000/fr/about` returns 301 (redirect to /en/about via invalid language catch-all)
- All existing tests pass
  </verify>
  <done>SSR routes for about, contact, workshop, policies are registered in Express with language middleware, returning 200 for valid languages and 301 for invalid ones</done>
</task>

</tasks>

<verification>
- All 4 static pages return 200 at /en/{page} and /he/{page}
- Page source contains unique title, meta description, canonical URL, OG tags, hreflang for each page
- Hebrew pages have dir="rtl" and Hebrew content
- English pages have dir="ltr" and English content
- Full page content is visible in HTML source (not empty containers)
- h1 tag present on every page with descriptive text
- Existing test suite passes with no regressions
</verification>

<success_criteria>
Four static pages fully SSR-rendered with bilingual content, complete SEO meta tags, and HTML structure matching existing frontend CSS expectations.
</success_criteria>

<output>
After completion, create `.planning/phases/24-static-page-ssr-meta-tags-deployment-merge/24-02-SUMMARY.md`
</output>
