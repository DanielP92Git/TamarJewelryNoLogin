---
phase: 19-base-view-tests
plan: 03
type: execute
wave: 2
depends_on:
  - 19-01
files_modified:
  - frontend/tests/view/header-menu.test.js
autonomous: true

must_haves:
  truths:
    - "English header menu renders Home, Shop, Jewelry Workshop, About, Contact Me links"
    - "Hebrew header menu renders בית, חנות, סדנאות תכשיטים, אודות, צרו קשר links"
    - "Navigation links have correct href attributes"
    - "Shop dropdown contains category links (Necklaces, Crochet Necklaces, Hoop Earrings, Dangle Earrings)"
    - "Menu content updates when language changes"
    - "Cart icon is rendered in header utilities"
  artifacts:
    - path: "frontend/tests/view/header-menu.test.js"
      provides: "Header menu rendering and navigation tests (VIEW-09, VIEW-10)"
      min_lines: 100
  key_links:
    - from: "frontend/tests/view/header-menu.test.js"
      to: "frontend/js/View.js"
      via: "import View from '../../js/View.js'"
      pattern: "import.*View.*from.*View\\.js"
    - from: "frontend/tests/view/header-menu.test.js"
      to: "frontend/tests/helpers/dom.js"
      via: "render() and screen for DOM setup and semantic queries"
      pattern: "import.*render.*screen.*from.*dom"
---

<objective>
Create header menu rendering and navigation tests covering VIEW-09 and VIEW-10.

Purpose: Validate that the header menu renders correct navigation links for both English and Hebrew, including the shop dropdown with category links, and that menu content updates correctly when language changes. Also verify that the cart icon renders in the header utilities area.

Output: frontend/tests/view/header-menu.test.js with tests for English navigation, Hebrew navigation, category dropdown, menu updates on language change, and cart icon rendering.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-base-view-tests/19-RESEARCH.md
@.planning/phases/19-base-view-tests/19-01-SUMMARY.md
@frontend/js/View.js
@frontend/tests/setup.js
@frontend/tests/helpers/dom.js
@frontend/vitest.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create header menu rendering and navigation tests</name>
  <files>frontend/tests/view/header-menu.test.js</files>
  <action>
Create comprehensive header menu tests covering VIEW-09 and VIEW-10.

**CRITICAL NOTES:**
- `setLanguage()` (line 736) replaces the entire `.menu` innerHTML with the output of `handleMenuLanguage(lng)`.
- `handleMenuLanguage(lng)` (lines 603-693) returns a `<ul class="menu__ul">` containing `<li class="main-nav-tab">` items.
- The Shop tab (`.categories-tab`) has a nested `<ul class="categories-list">` with category items.
- After setLanguage(), the desktop utilities area (`[data-purpose="header-utilities"]`) gets a cart link with `.header-cart` class.
- The cart number element `.cart-number-mobile` is rendered inside the header utilities.
- The footer is also updated via `handleFooterMarkup(lng)` (line 900).
- Use @testing-library/dom semantic queries (getByRole, getByText, getAllByRole) for resilient assertions.
- Query elements AFTER `await view.setLanguage()` since innerHTML is replaced.

**Import pattern:**
```javascript
import { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';
import { render, screen } from '../helpers/dom.js';
import View from '../../js/View.js';
```

**Required DOM fixture:**
```html
<header></header>
<div class="menu"></div>
<div data-purpose="header-utilities"></div>
<div class="footer"></div>
```

**Test structure:**

a) `describe('English Navigation Links (VIEW-09)')` - Header menu renders English navigation links
   - After `await view.setLanguage('eng', 0)`:
     - Verify link to Home: `screen.getByRole('link', { name: /home/i })` has href `/index.html`
     - Verify link to Jewelry Workshop: text matches /jewelry workshop/i, href `/html/jewelry-workshop.html`
     - Verify link to About: text matches /about/i, href `/html/about.html`
     - Verify link to Contact Me: text matches /contact me/i, href `/html/contact-me.html`
     - Verify Shop text exists: `screen.getByText(/shop/i)` is present

b) `describe('English Category Dropdown (VIEW-09)')` - Shop dropdown contains category links
   - After `await view.setLanguage('eng', 0)`:
     - Verify Necklaces link: href `/html/categories/necklaces.html`
     - Verify Crochet Necklaces link: href `/html/categories/crochetNecklaces.html`
     - Verify Hoop Earrings link: href `/html/categories/hoops.html`
     - Verify Dangle Earrings link: href `/html/categories/dangle.html`
     - Verify `.categories-list` element exists within `.categories-tab`

c) `describe('Hebrew Navigation Links (VIEW-09)')` - Header menu renders Hebrew navigation links
   - After `await view.setLanguage('heb', 0)`:
     - Verify link to בית: href `/index.html`
     - Verify link to סדנאות תכשיטים: href `/html/jewelry-workshop.html`
     - Verify link to אודות: href `/html/about.html`
     - Verify link to צרו קשר: href `/html/contact-me.html`
     - Verify חנות text exists

d) `describe('Hebrew Category Dropdown (VIEW-09)')` - Hebrew shop dropdown contains category links
   - After `await view.setLanguage('heb', 0)`:
     - Verify שרשראות (Necklaces): href `/html/categories/necklaces.html`
     - Verify שרשראות סרוגות (Crochet Necklaces): href `/html/categories/crochetNecklaces.html`
     - Verify עגילי חישוק (Hoop Earrings): href `/html/categories/hoops.html`
     - Verify עגילים תלויים (Dangle Earrings): href `/html/categories/dangle.html`

e) `describe('Menu State Updates on Language Change (VIEW-10)')` - Header menu state updates on navigation
   - Start with English: `await view.setLanguage('eng', 0)`
   - Verify English text present (Home, About, etc.)
   - Switch to Hebrew: `await view.setLanguage('heb', 0)`
   - Verify English text is GONE and Hebrew text is present
   - Switch back to English: `await view.setLanguage('eng', 0)`
   - Verify Hebrew text is GONE and English text is present
   - This validates that menu content fully replaces on language change

f) `describe('Cart Icon in Header (VIEW-09)')` - Cart icon renders in header utilities
   - After `await view.setLanguage('eng', 0)`:
     - Verify cart link with class `.header-cart` or role link with name /cart/i exists
     - Verify cart link href is `/html/cart.html`
     - Verify `.cart-number-mobile` element exists for cart count display

g) `describe('Cart Number Display (VIEW-10)')` - Cart number updates via persistCartNumber
   - Call `await view.setLanguage('eng', 5)` (passing cartNum = 5)
   - Verify `.cart-number-mobile` textContent is '5'
   - Call `await view.setLanguage('eng', 0)` (cartNum = 0)
   - Verify `.cart-number-mobile` textContent is '0'

h) `describe('Footer Updates on Language Change (VIEW-10)')` - Footer content updates with menu
   - After `await view.setLanguage('eng', 0)`:
     - Verify footer contains English text (e.g., "Shipping & Cancellation Policy")
   - After `await view.setLanguage('heb', 0)`:
     - Verify footer contains Hebrew text (e.g., "מדיניות משלוח וביטול")

**afterEach cleanup:**
```javascript
afterEach(() => {
  delete window.__currencyPersistenceInitialized;
});
```

**Important query notes:**
- For Hebrew text matching, use exact strings or partial regex: `/בית/` matches "בית " (with trailing space in the source HTML).
- Some links share text (e.g., "Home" appears in menu and footer). Use `getAllByRole('link', { name: /home/i })` and check the first match, or scope queries to specific containers with `within()` from @testing-library/dom.
- For category links, use `getAllByRole('link', { name: /necklaces/i })` since the text may appear in both menu and footer. Verify at least one has the correct href.

Target: At least 15 tests covering VIEW-09 and VIEW-10.
  </action>
  <verify>Run `npm test -- --run tests/view/header-menu.test.js` from frontend directory - all tests pass</verify>
  <done>Header menu rendering and navigation tests validate VIEW-09 and VIEW-10</done>
</task>

</tasks>

<verification>
1. Test file exists at frontend/tests/view/header-menu.test.js
2. `npm test -- --run tests/view/header-menu.test.js` passes all tests
3. Tests verify English navigation links with correct hrefs (VIEW-09)
4. Tests verify Hebrew navigation links with correct hrefs (VIEW-09)
5. Tests verify category dropdown links in both languages (VIEW-09)
6. Tests verify menu content updates on language change (VIEW-10)
7. Tests verify cart icon renders with correct link (VIEW-09)
8. Tests verify cart number updates via persistCartNumber (VIEW-10)
9. All existing tests still pass
</verification>

<success_criteria>
- English and Hebrew navigation links verified with correct hrefs
- Category dropdown contains all 4 category links in both languages
- Menu content fully replaces when language changes
- Cart icon renders with link to /html/cart.html
- Cart number display updates correctly
- Footer content updates with language switch
- At least 15 tests passing
- No regression in existing test suite
</success_criteria>

<output>
After completion, create `.planning/phases/19-base-view-tests/19-03-SUMMARY.md`
</output>
