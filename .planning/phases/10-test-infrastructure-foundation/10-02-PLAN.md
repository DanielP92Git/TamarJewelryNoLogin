---
phase: 10-test-infrastructure-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/vitest.config.js
  - frontend/tests/setup.js
  - frontend/tests/helpers/dom.js
  - frontend/package.json
autonomous: true

must_haves:
  truths:
    - "npm test runs in frontend directory without errors"
    - "Tests can render DOM elements and query them"
    - "jsdom environment simulates browser APIs"
    - "localStorage is available in tests"
  artifacts:
    - path: "frontend/vitest.config.js"
      provides: "Vitest configuration for frontend"
      contains: "defineConfig"
    - path: "frontend/tests/setup.js"
      provides: "Global test setup with jsdom environment"
      contains: "beforeEach"
    - path: "frontend/tests/helpers/dom.js"
      provides: "DOM testing utilities"
      exports: ["renderHTML", "clearDOM", "mockLocalStorage"]
  key_links:
    - from: "frontend/vitest.config.js"
      to: "frontend/tests/setup.js"
      via: "setupFiles config"
      pattern: "setupFiles.*setup"
---

<objective>
Install and configure Vitest testing framework for frontend Vanilla JS testing with jsdom environment.

Purpose: Enable frontend unit testing with DOM simulation, allowing tests for View classes, model functions, and locale logic without a real browser.
Output: Working test runner configuration with DOM helpers and localStorage mocking.
</objective>

<execution_context>
@C:\Users\pagis\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\pagis\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-test-infrastructure-foundation/10-CONTEXT.md

# Current frontend package.json
@frontend/package.json

# Frontend architecture reference
@frontend/js/View.js
@frontend/js/model.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vitest and jsdom for frontend</name>
  <files>frontend/package.json</files>
  <action>
Install Vitest and jsdom as dev dependencies in frontend:

```bash
cd frontend
npm install --save-dev vitest jsdom @vitest/coverage-v8
```

Add test scripts to package.json:
- "test": "vitest run"
- "test:watch": "vitest"
- "test:coverage": "vitest run --coverage"

Do NOT modify existing scripts (dev, build, lint, cleanup, etc.).
  </action>
  <verify>
Run `npm ls vitest jsdom` in frontend directory - both packages listed.
Check frontend/package.json has test scripts.
  </verify>
  <done>
Vitest and jsdom are installed as devDependencies.
Test scripts added to package.json.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Vitest configuration and DOM test helpers</name>
  <files>
    frontend/vitest.config.js
    frontend/tests/setup.js
    frontend/tests/helpers/dom.js
  </files>
  <action>
Create frontend/vitest.config.js:
- Use defineConfig from vitest/config
- Set test environment to 'jsdom' (browser simulation)
- Set testMatch to include files in tests/**/*.test.js and js/**/*.test.js
- Set setupFiles to ['./tests/setup.js']
- Enable globals (describe, it, expect available without import)
- Set timeout to 10000ms (generous for DOM operations)
- Exclude node_modules, .parcel-cache, dist from watch

Create frontend/tests/setup.js:
- Import jsdom implicitly via Vitest environment
- beforeEach: Clear document.body.innerHTML
- afterEach: Clear all localStorage keys
- Mock window.scrollTo (common SPA need, does nothing in tests)
- Mock window.location.assign (prevent actual navigation)

Create frontend/tests/helpers/dom.js with exports:
- renderHTML(html): Set document.body.innerHTML and return document
- clearDOM(): Reset document.body to empty state
- mockLocalStorage(): Create fresh localStorage mock with get/set/remove/clear
- waitForDOM(selector, timeout): Return promise that resolves when element appears
- simulateClick(element): Dispatch click event on element
- simulateInput(element, value): Set input value and dispatch input event

Include JSDoc comments explaining each function's purpose.
  </action>
  <verify>
Files exist at:
- frontend/vitest.config.js
- frontend/tests/setup.js
- frontend/tests/helpers/dom.js

Run from frontend directory:
```bash
npx vitest run --passWithNoTests
```
Should complete without errors (no tests yet, but setup runs).
  </verify>
  <done>
Vitest configuration created with jsdom environment.
Setup file provides DOM cleanup between tests.
DOM helper functions exported for test use.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create smoke test to verify frontend infrastructure</name>
  <files>frontend/tests/infrastructure.test.js</files>
  <action>
Create frontend/tests/infrastructure.test.js as a minimal smoke test:

```javascript
import { describe, it, expect, beforeEach } from 'vitest';
import { renderHTML, clearDOM, mockLocalStorage } from './helpers/dom.js';

describe('Frontend Test Infrastructure', () => {
  beforeEach(() => {
    clearDOM();
  });

  it('should have access to document and window', () => {
    expect(document).toBeDefined();
    expect(window).toBeDefined();
  });

  it('should be able to render and query DOM', () => {
    renderHTML('<div id="test-element">Hello</div>');
    const element = document.getElementById('test-element');
    expect(element).toBeDefined();
    expect(element.textContent).toBe('Hello');
  });

  it('should have localStorage available', () => {
    localStorage.setItem('test-key', 'test-value');
    expect(localStorage.getItem('test-key')).toBe('test-value');
  });

  it('should clean up localStorage between tests', () => {
    // Previous test set 'test-key', this test should not see it
    // (setup.js afterEach clears localStorage)
    expect(localStorage.getItem('test-key')).toBeNull();
  });

  it('should be able to add event listeners', () => {
    let clicked = false;
    renderHTML('<button id="test-btn">Click me</button>');
    const btn = document.getElementById('test-btn');
    btn.addEventListener('click', () => { clicked = true; });
    btn.click();
    expect(clicked).toBe(true);
  });
});
```

This verifies:
1. jsdom environment provides document/window
2. DOM manipulation works
3. localStorage is available
4. Cleanup happens between tests
5. Event listeners function correctly
  </action>
  <verify>
Run from frontend directory:
```bash
npm test
```
All 5 tests should pass.
  </verify>
  <done>
Smoke test passes confirming:
- Vitest runs correctly in frontend
- jsdom provides working browser APIs
- DOM testing helpers function correctly
- localStorage cleanup works between tests
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm test` - All tests pass
2. `cd frontend && npm test -- --reporter=verbose` - Shows test names
3. DOM operations work (createElement, querySelector, etc.)
4. localStorage operations work
5. Tests complete in under 10 seconds
</verification>

<success_criteria>
- Vitest installed and configured in frontend
- jsdom environment provides browser simulation
- `npm test` runs and passes in frontend directory
- Smoke test verifies DOM and localStorage functionality
- DOM helpers exported for use in future tests
</success_criteria>

<output>
After completion, create `.planning/phases/10-test-infrastructure-foundation/10-02-SUMMARY.md`
</output>
