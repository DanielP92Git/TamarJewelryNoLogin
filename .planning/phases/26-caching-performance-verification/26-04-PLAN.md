---
phase: 26-caching-performance-verification
plan: 04
type: execute
wave: 3
depends_on: ["26-01", "26-02", "26-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Full test suite (866 tests: 447 backend + 419 frontend) passes with zero regressions"
    - "Structured data on SSR pages is valid and ready for Google Rich Results Test"
    - "Cache middleware is functioning correctly with X-Cache headers visible in responses"
  artifacts: []
  key_links: []
---

<objective>
Run the complete test suite to confirm zero regressions after all SSR and caching changes, and verify structured data is valid for Google Rich Results testing.

Purpose: Confirm the caching layer does not break any existing functionality and that the site is production-ready for SEO.
Output: Test results confirming zero regressions, structured data validation results.
</objective>

<execution_context>
@C:/Users/pagis/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/pagis/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-caching-performance-verification/26-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full test suite and verify zero regressions</name>
  <files></files>
  <action>
1. Run the backend test suite:
   ```bash
   cd backend && npm test
   ```
   - Expected: 447 tests pass (per research, actual count may vary slightly)
   - Record exact pass/fail/skip counts

2. Run the frontend test suite:
   ```bash
   cd frontend && npm test
   ```
   - Expected: 419 tests pass
   - Record exact pass/fail/skip counts

3. If any tests fail:
   - Check if failures are related to the new cache modules (imports, side effects)
   - Cache middleware should be skipped in test environment (`NODE_ENV === 'test'`), so no test should be affected
   - If failures exist, investigate and fix — do NOT skip this step

4. Record total test count and compare to known baseline (866 total = 447 + 419)
  </action>
  <verify>
  - Backend: all tests pass with 0 failures
  - Frontend: all tests pass with 0 failures
  - Total tests >= 866
  </verify>
  <done>Complete test suite passes with zero regressions, total test count recorded and matches or exceeds baseline</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify caching headers and structured data in browser</name>
  <files></files>
  <action>
Human verification checkpoint. Claude has completed all automated work in plans 01-03 and Task 1 of this plan. The user now needs to verify:

1. **Caching headers** — Run backend locally (`npm run devStart`), visit SSR pages, check X-Cache and Cache-Control response headers in DevTools
2. **Structured data** — Validate JSON-LD on product pages using Google Rich Results Test
3. **Google Fonts** — Confirm no render-blocking font warnings in Lighthouse
4. **Google Search Console** — Manual setup: add property, get verification code, set GOOGLE_SITE_VERIFICATION env var, submit sitemap

Detailed verification steps provided in how-to-verify below.
  </action>
  <verify>
  - X-Cache: MISS on first visit, X-Cache: HIT on second visit to same URL
  - Cache-Control: public, max-age=3600, stale-while-revalidate=86400 present
  - Different language URLs produce different cache entries (MISS independently)
  - Rich Results Test shows zero errors for Product and BreadcrumbList structured data
  - No "Ensure text remains visible during webfont load" Lighthouse warning
  </verify>
  <done>User confirms caching headers are correct, structured data validates, and Google Search Console setup is complete or planned</done>
  <what-built>SSR page caching with HTTP cache headers, cache invalidation on product CRUD, Google Fonts with display=swap, and Google Search Console meta tag placeholder</what-built>
  <how-to-verify>
**Caching verification (run backend locally with `npm run devStart`):**

1. Visit any SSR page twice (e.g., `http://localhost:PORT/en/necklaces`)
2. Open DevTools > Network tab, check Response Headers:
   - First visit: `X-Cache: MISS`, `Cache-Control: public, max-age=3600, stale-while-revalidate=86400`
   - Second visit: `X-Cache: HIT` (same Cache-Control header)
3. Visit `/he/necklaces` — should be `X-Cache: MISS` (different language = different cache key)

**Structured data verification:**
1. View page source on a product page (e.g., `/en/product/[any-slug]`)
2. Find the `<script type="application/ld+json">` block
3. Copy the JSON-LD content
4. Go to https://search.google.com/test/rich-results
5. Paste the JSON-LD or enter the URL (if publicly accessible)
6. Confirm: zero errors, Product and BreadcrumbList types detected

**Google Fonts verification:**
1. Open DevTools > Performance or Lighthouse
2. Check that no "Ensure text remains visible during webfont load" warning appears

**Note:** Google Search Console verification (CRAWL-07) requires manual setup — go to https://search.google.com/search-console, add property, choose HTML tag method, copy the verification code, and set it as `GOOGLE_SITE_VERIFICATION` env var on DigitalOcean. Then submit `/sitemap.xml` in Search Console.
  </how-to-verify>
  <resume-signal>Type "approved" if caching headers are correct and structured data validates, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- Test suite: 866+ tests pass, 0 failures
- X-Cache header appears on SSR responses (HIT on second visit)
- Cache-Control header includes stale-while-revalidate
- Structured data validates in Rich Results Test
</verification>

<success_criteria>
Zero test regressions confirmed, caching verified working in browser with correct headers, structured data ready for Google Rich Results, and site is production-ready for Google Search Console verification.
</success_criteria>

<output>
After completion, create `.planning/phases/26-caching-performance-verification/26-04-SUMMARY.md`
</output>
